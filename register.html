<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social</title>
    <link rel="icon" type="image/x-icon" href="assets/images/icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200..1000;1,200..1000&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/normalize.css">
    <link rel="stylesheet" href="assets/css/pages/access.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>
    <div class="accessBg">
        <main class="accessPanel">
            <h1>
                Rejestracja
            </h1>
            <form method="POST">
                <label for="username" class="sr-only">Username</label>
                <input type="text" id="username" name="username" placeholder="Username" class="nunito" autocomplete="username" inputmode="text" required>
                <p class="error-message hidden" id="username-error">Nazwa użytkownika musi zawierać 3-18 znaków alfanumerycznych.</p>
                <label for="email" class="sr-only">Email</label>
                <input type="email" id="email" name="email" placeholder="E-mail" class="nunito" autocomplete="email" required>
                <p class="error-message hidden" id="email-error">Podaj poprawny adres e-mail.</p>
                <label for="pass" class="sr-only">Hasło</label>
                <input type="password" id="pass" name="new-password" placeholder="Hasło" class="nunito" autocomplete="new-password" required>
                <p class="error-message hidden" id="pass-error">Hasło musi zawierać co najmniej 8 znaków.</p>
                <div class="password-strength hidden">
                    <div class="strength-bar">
                        <div class="strength-fill"></div>
                    </div>
                </div>
                <label for="passConfirm" class="sr-only">Powtórz hasło</label>
                <input type="password" id="passConfirm" name="confirm-password" placeholder="Powtórz hasło" class="nunito password-hidden" autocomplete="new-password" required>
                <p class="error-message hidden" id="passConfirm-error">Podane hasła różnią się.</p>
                <!--<div class="g-recaptcha" data-sitekey="6LeQtfgqAAAAAPe_D8jzbyZ_FQvB9R-_b-A8B53B"></div>-->
                <button type="submit" class="nunito submit-access" id="register-btn">Zarejestruj się</button>
            </form>
            <p class="bottomLink">
                <a href="index.html">Masz już konto? Zaloguj się</a>
            </p>
        </main>
        <nav class="switch">
            <a href="index.html" class="circular-link">
                <img src="assets/images/user_login.png" alt="Login user">
            </a>
        </nav>
    </div>

<script>
    function hide(e) {
        e.classList.remove("show");
        setTimeout(() => {
            e.classList.add("hidden");
        }, 300);
    }

    function show(e) {
        e.classList.add("show");
        setTimeout(() => {
            e.classList.remove("hidden");
        }, 10); 
    }

    const submitButton = document.getElementById("register-btn");

    let userTimeout;

    document.getElementById("username").addEventListener("input", function() {
        clearTimeout(userTimeout);

        userTimeout = setTimeout(() => {
            const userInput = this.value;
            const errorMsg = document.getElementById("username-error");
    
            const isValid = /^[a-zA-Z0-9]{3,18}$/.test(userInput);
    
            if (userInput === "") {
                hide(errorMsg);
            } else if (!isValid) {
                show(errorMsg);
            } else {
                hide(errorMsg);
            }
        }, 500);
    });

    let emailTimeout;

    document.getElementById("email").addEventListener("input", function() {
        clearTimeout(emailTimeout);

        emailTimeout = setTimeout(() => {
            const emailInput = this.value;
            const errorMsg = document.getElementById("email-error");

            const isValid = /^[a-zA-Z0-9][a-zA-Z0-9._%+-]*@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(emailInput);

            if (emailInput === "") {
                hide(errorMsg);
            } else if (!isValid) {
                show(errorMsg);
            } else {
                hide(errorMsg);
            }
        }, 500);
    });

    let passwordTimeout;

    document.getElementById("pass").addEventListener("input", function() {
        clearTimeout(passwordTimeout);

        passwordTimeout = setTimeout(() => {
        
            const password = this.value;
            const errorMsg = document.getElementById("pass-error");
            const strengthBar = document.querySelector(".password-strength");
            const strengthFill = document.querySelector(".strength-fill");
            const passConfirm = document.getElementById("passConfirm");
            const passConfirmError = document.getElementById("passConfirm-error");

            if (password === "") {
                strengthBar.classList.remove("show");
                setTimeout(() => {
                    strengthBar.classList.add("hidden");
                    strengthBar.style.display = "none";
                    errorMsg.style.display = "block";
                }, 300);
                strengthFill.style.width = "0";
                hide(errorMsg);
                hide(passConfirmError);
                passConfirm.classList.remove("password-visible");
                passConfirm.classList.add("password-hidden");
                return;
            }

            if (password.length < 8) {
                strengthBar.classList.remove("show");
                setTimeout(() => {
                    strengthBar.classList.add("hidden");
                    strengthBar.style.display = "none";
                }, 300);
                strengthFill.style.width = "0";
                setTimeout(() => {
                    errorMsg.style.display = "block";
                    setTimeout(() => {
                        errorMsg.classList.remove("hidden");
                        errorMsg.classList.add("show");
                    }, 10); 
                }, 300);
                hide(passConfirmError);
                passConfirm.classList.remove("password-visible");
                passConfirm.classList.add("password-hidden");
            } else {
                passConfirm.classList.add("password-visible");
                passConfirm.classList.remove("password-hidden");
                if (password != passConfirm.value && passConfirm.value != "") {
                    show(passConfirmError);
                } else if (password === passConfirm.value) {
                    hide(passConfirmError);
                }

                errorMsg.classList.remove("show");
                errorMsg.classList.add("hidden");
                setTimeout(() => {
                    errorMsg.style.display = "none";
                }, 300);
                setTimeout(() => {
                    strengthBar.style.display = "block";
                    setTimeout(() => {
                        strengthBar.classList.remove("hidden");
                        strengthBar.classList.add("show");
                    }, 10); 
                }, 300);

                let strength = checkPasswordStrength(password);

                if (strength === "weak") {
                    strengthFill.style.width = "33%";
                    strengthFill.className = "strength-fill weak";
                } else if (strength === "medium") {
                    strengthFill.style.width = "66%";
                    strengthFill.className = "strength-fill medium";
                } else {
                    strengthFill.style.width = "100%";
                    strengthFill.className = "strength-fill strong";
                }
            }
        }, 500);
    });

    function checkPasswordStrength(password) {
        let strength = 0;
        if (password.length >= 8) strength++;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password) && /\d/.test(password)) strength++;
        if (password.length >= 12 && /[a-z]/.test(password) && /[A-Z]/.test(password) && /\d/.test(password) && /[^A-Za-z0-9]/.test(password)) strength++;

        if (strength <= 1) return "weak";
        if (strength === 2) return "medium";
        return "strong";
    }

    let confirmPassTimeout;

    document.getElementById("passConfirm").addEventListener("input", function() {
        clearTimeout(confirmPassTimeout);

        confirmPassTimeout = setTimeout(() => {
            const passConfirmInput = this.value;
            const password = document.getElementById("pass").value;
            const errorMsg = document.getElementById("passConfirm-error");

            const isValid = (password === passConfirmInput);

            if (this.classList.contains("password-visible") && !isValid) {
                show(errorMsg);
            } else {
                hide(errorMsg);
            }
        }, 500);
    });

</script>
</body>
</html>